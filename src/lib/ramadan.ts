import { differenceInDays, startOfDay } from 'date-fns';

// Helper to get Hijri date using Intl API
export const getHijriDate = () => {
  const date = new Date();
  const options: Intl.DateTimeFormatOptions = {
    calendar: 'islamic-umalqura',
    day: 'numeric',
    month: 'numeric',
    year: 'numeric'
  };
  
  // Format: "M/D/Y" or "D/M/Y" depending on locale, but we can extract parts
  const formatter = new Intl.DateTimeFormat('en-US-u-ca-islamic-umalqura', options);
  const parts = formatter.formatToParts(date);
  
  const day = parseInt(parts.find(p => p.type === 'day')?.value || '1');
  const month = parseInt(parts.find(p => p.type === 'month')?.value || '1');
  const year = parseInt(parts.find(p => p.type === 'year')?.value || '1447');
  
  return { day, month, year };
};

export const getRamadanDay = (): number => {
  const { day, month } = getHijriDate();
  
  // Ramadan is the 9th month
  if (month === 9) {
    return day;
  }
  
  // Shawwal is the 10th month. If it's 1st Shawwal, it's Eid.
  // We'll return 100 for Eid to distinguish it.
  if (month === 10 && day === 1) {
    return 100; // Eid Code
  }
  
  // Before Ramadan (Months 1-8)
  if (month < 9) {
    return -1;
  }
  
  // After Ramadan (Months 10-12, excluding 1st Shawwal which is handled above)
  return 31;
};

export const ramadanEvents = [
  { day: 1, event: "نزول الوحي على النبي محمد ﷺ في غار حراء (على أحد الأقوال).", title: "بداية الوحي" },
  { day: 2, event: "نزول صحف إبراهيم عليه السلام.", title: "صحف إبراهيم" },
  { day: 3, event: "وفاة السيدة فاطمة الزهراء رضي الله عنها (11 هـ).", title: "وفاة فاطمة الزهراء" },
  { day: 4, event: "عقد النبي ﷺ لواءً لحمزة بن عبد المطلب (1 هـ).", title: "لواء حمزة" },
  { day: 5, event: "دخول المعز لدين الله الفاطمي القاهرة (362 هـ).", title: "دخول المعز للقاهرة" },
  { day: 6, event: "نزول التوراة على موسى عليه السلام.", title: "نزول التوراة" },
  { day: 7, event: "افتتاح الجامع الأزهر في القاهرة (361 هـ).", title: "افتتاح الأزهر" },
  { day: 8, event: "غزوة بدر الأولى (2 هـ).", title: "غزوة بدر الأولى" },
  { day: 9, event: "وصول جيش المسلمين إلى الأندلس بقيادة طارق بن زياد (92 هـ).", title: "فتح الأندلس" },
  { day: 10, event: "وفاة السيدة خديجة بنت خويلد رضي الله عنها (قبل الهجرة بـ 3 سنوات).", title: "وفاة خديجة" },
  { day: 11, event: "مؤاخاة النبي ﷺ بين المهاجرين والأنصار (1 هـ).", title: "المؤاخاة" },
  { day: 12, event: "دخول النبي ﷺ المدينة المنورة (1 هـ).", title: "دخول المدينة" },
  { day: 13, event: "نزول الإنجيل على عيسى عليه السلام.", title: "نزول الإنجيل" },
  { day: 14, event: "وفاة مظفر الدين كوكبري، أحد قادة صلاح الدين (630 هـ).", title: "وفاة كوكبري" },
  { day: 15, event: "مولد الإمام الحسن بن علي رضي الله عنهما (3 هـ).", title: "مولد الحسن" },
  { day: 16, event: "وفاة المؤرخ المقريزي (845 هـ).", title: "وفاة المقريزي" },
  { day: 17, event: "غزوة بدر الكبرى (2 هـ) - يوم الفرقان.", title: "غزوة بدر الكبرى" },
  { day: 18, event: "نزول الزبور على داود عليه السلام.", title: "نزول الزبور" },
  { day: 19, event: "فتح مكة (8 هـ).", title: "فتح مكة" },
  { day: 20, event: "فتح مكة (استكمال الدخول والسيطرة) (8 هـ).", title: "فتح مكة" },
  { day: 21, event: "وفاة الإمام علي بن أبي طالب رضي الله عنه (40 هـ).", title: "وفاة علي بن أبي طالب" },
  { day: 22, event: "ميلاد ابن ماجه، صاحب السنن (209 هـ).", title: "ميلاد ابن ماجه" },
  { day: 23, event: "نزول القرآن الكريم إلى السماء الدنيا (ليلة القدر على أحد الأقوال).", title: "نزول القرآن" },
  { day: 24, event: "بدء بناء مسجد عمرو بن العاص في الفسطاط (21 هـ).", title: "مسجد عمرو بن العاص" },
  { day: 25, event: "معركة عين جالوت (658 هـ) - انتصار المسلمين على المغول.", title: "معركة عين جالوت" },
  { day: 26, event: "وفاة ابن خلدون (808 هـ).", title: "وفاة ابن خلدون" },
  { day: 27, event: "ليلة القدر (على الأرجح).", title: "ليلة القدر" },
  { day: 28, event: "دخول المسلمين الأندلس (92 هـ).", title: "دخول الأندلس" },
  { day: 29, event: "فرض زكاة الفطر (2 هـ).", title: "فرض زكاة الفطر" },
  { day: 30, event: "وفاة عمرو بن العاص (43 هـ).", title: "وفاة عمرو بن العاص" }
];

export const quranJuz = [
  { 
    juz: 1, 
    surahs: "الفاتحة - البقرة (141)", 
    dua: "اللهم اجعل القرآن ربيع قلوبنا",
    keyVerse: {
      text: "اهْدِنَا الصِّرَاطَ الْمُسْتَقِيمَ",
      reference: "سورة الفاتحة: 6"
    },
    tafsir: "أي دلنا وأرشدنا، ووفقنا للصراط المستقيم، وهو الطريق الواضح الذي لا اعوجاج فيه، وهو الإسلام الذي أرسل الله به محمداً صلى الله عليه وسلم."
  },
  { 
    juz: 2, 
    surahs: "البقرة (142 - 252)", 
    dua: "اللهم ذكرنا منه ما نسينا",
    keyVerse: {
      text: "وَإِذَا سَأَلَكَ عِبَادِي عَنِّي فَإِنِّي قَرِيبٌ ۖ أُجِيبُ دَعْوَةَ الدَّاعِ إِذَا دَعَانِ",
      reference: "سورة البقرة: 186"
    },
    tafsir: "آية عظيمة في استجابة الدعاء، جاءت بين آيات الصيام لتدل على ارتباط الصيام بالدعاء، وأن الله قريب من عباده يسمع دعاءهم ويجيبهم."
  },
  { 
    juz: 3, 
    surahs: "البقرة (253) - آل عمران (92)", 
    dua: "اللهم ارزقنا تلاوته آناء الليل وأطراف النهار",
    keyVerse: {
      text: "اللَّهُ لَا إِلَٰهَ إِلَّا هُوَ الْحَيُّ الْقَيُّومُ ۚ لَا تَأْخُذُهُ سِنَةٌ وَلَا نَوْمٌ",
      reference: "سورة البقرة: 255 (آية الكرسي)"
    },
    tafsir: "أعظم آية في كتاب الله، اشتملت على صفات الكمال لله تعالى، من الحياة الكاملة والقيومية المطلقة، ونفي النقائص عنه سبحانه."
  },
  { 
    juz: 4, 
    surahs: "آل عمران (93) - النساء (23)", 
    dua: "اللهم اجعلنا من أهل القرآن",
    keyVerse: {
      text: "وَاعْتَصِمُوا بِحَبْلِ اللَّهِ جَمِيعًا وَلَا تَفَرَّقُوا",
      reference: "سورة آل عمران: 103"
    },
    tafsir: "أمر من الله للمؤمنين بالاجتماع على دينه والتمسك بكتابه، والنهي عن التفرق والاختلاف الذي يضعف الأمة."
  },
  { 
    juz: 5, 
    surahs: "النساء (24 - 147)", 
    dua: "اللهم ارحمنا بالقرآن",
    keyVerse: {
      text: "إِنَّ اللَّهَ يَأْمُرُكُمْ أَن تُؤَدُّوا الْأَمَانَاتِ إِلَىٰ أَهْلِهَا",
      reference: "سورة النساء: 58"
    },
    tafsir: "أمر عام بأداء جميع أنواع الأمانات، سواء كانت حقوقاً لله تعالى أو حقوقاً للعباد، والحكم بالعدل بين الناس."
  },
  { 
    juz: 6, 
    surahs: "النساء (148) - المائدة (81)", 
    dua: "اللهم اجعله لنا إماماً ونوراً وهدى ورحمة",
    keyVerse: {
      text: "يَا أَيُّهَا الَّذِينَ آمَنُوا مَن يَرْتَدَّ مِنكُمْ عَن دِينِهِ فَسَوْفَ يَأْتِي اللَّهُ بِقَوْمٍ يُحِبُّهُمْ وَيُحِبُّونَهُ",
      reference: "سورة المائدة: 54"
    },
    tafsir: "إخبار من الله بأنه غني عن العالمين، وأن من ترك دينه فلن يضر الله شيئاً، وسيأتي الله بقوم خير منهم يحبهم ويحبونه."
  },
  { 
    juz: 7, 
    surahs: "المائدة (82) - الأنعام (110)", 
    dua: "اللهم ألبسنا به الحلل",
    keyVerse: {
      text: "وَإِذَا سَمِعُوا مَا أُنزِلَ إِلَى الرَّسُولِ تَرَىٰ أَعْيُنَهُمْ تَفِيضُ مِنَ الدَّمْعِ مِمَّا عَرَفُوا مِنَ الْحَقِّ",
      reference: "سورة المائدة: 83"
    },
    tafsir: "وصف لحال المؤمنين الصادقين عند سماع القرآن، حيث تلين قلوبهم وتدمع أعينهم خشوعاً وتأثراً بكلام الله."
  },
  { 
    juz: 8, 
    surahs: "الأنعام (111) - الأعراف (87)", 
    dua: "اللهم أسكنا به الظلل",
    keyVerse: {
      text: "قُلْ إِنَّ صَلَاتِي وَنُسُكِي وَمَحْيَايَ وَمَمَاتِي لِلَّهِ رَبِّ الْعَالَمِينَ",
      reference: "سورة الأنعام: 162"
    },
    tafsir: "إعلان التوحيد الخالص، وأن حياة المسلم كلها، عباداته وحياته وموته، خالصة لله وحده لا شريك له."
  },
  { 
    juz: 9, 
    surahs: "الأعراف (88) - الأنفال (40)", 
    dua: "اللهم ادفع عنا به النقم",
    keyVerse: {
      text: "وَرَحْمَتِي وَسِعَتْ كُلَّ شَيْءٍ ۚ فَسَأَكْتُبُهَا لِلَّذِينَ يَتَّقُونَ وَيُؤْتُونَ الزَّكَاةَ",
      reference: "سورة الأعراف: 156"
    },
    tafsir: "بيان لسعة رحمة الله التي شملت كل شيء، ولكنها في الآخرة خاصة للمتقين الذين يمتثلون أوامر الله ويجتنبون نواهيه."
  },
  { 
    juz: 10, 
    surahs: "الأنفال (41) - التوبة (92)", 
    dua: "اللهم اجعلنا عند النعماء من الشاكرين",
    keyVerse: {
      text: "وَأَطِيعُوا اللَّهَ وَرَسُولَهُ وَلَا تَنَازَعُوا فَتَفْشَلُوا وَتَذْهَبَ رِيحُكُمْ ۖ وَاصْبِرُوا ۚ إِنَّ اللَّهَ مَعَ الصَّابِرِينَ",
      reference: "سورة الأنفال: 46"
    },
    tafsir: "دعوة للوحدة وطاعة القيادة، والتحذير من النزاع الذي يؤدي للفشل والضعف، والأمر بالصبر لأن الله مع الصابرين."
  },
  { 
    juz: 11, 
    surahs: "التوبة (93) - هود (5)", 
    dua: "اللهم اجعلنا عند البلاء من الصابرين",
    keyVerse: {
      text: "وَالسَّابِقُونَ الْأَوَّلُونَ مِنَ الْمُهَاجِرِينَ وَالْأَنصَارِ وَالَّذِينَ اتَّبَعُوهُم بِإِحْسَانٍ رَّضِيَ اللَّهُ عَنْهُمْ وَرَضُوا عَنْهُ",
      reference: "سورة التوبة: 100"
    },
    tafsir: "تزكية من الله للصحابة الكرام من المهاجرين والأنصار ومن تبعهم، وبيان رضاه عنهم وإعداد الجنات لهم."
  },
  { 
    juz: 12, 
    surahs: "هود (6) - يوسف (52)", 
    dua: "اللهم لا تجعلنا ممن استهوته الشياطين",
    keyVerse: {
      text: "إِنَّ الْحَسَنَاتِ يُذْهِبْنَ السَّيِّئَاتِ ۚ ذَٰلِكَ ذِكْرَىٰ لِلذَّاكِرِينَ",
      reference: "سورة هود: 114"
    },
    tafsir: "قاعدة عظيمة في التعامل مع الذنوب، ففعل الخيرات والطاعات يمحو أثر السيئات والخطايا."
  },
  { 
    juz: 13, 
    surahs: "يوسف (53) - إبراهيم (52)", 
    dua: "اللهم انفعنا بما علمتنا",
    keyVerse: {
      text: "قَالَ إِنَّمَا أَشْكُو بَثِّي وَحُزْنِي إِلَى اللَّهِ",
      reference: "سورة يوسف: 86"
    },
    tafsir: "درس في التوكل واللجوء إلى الله عند الشدائد، فيعقوب عليه السلام لم يشكُ حاله للناس بل بث شكواه لخالقه."
  },
  { 
    juz: 14, 
    surahs: "الحجر - النحل (128)", 
    dua: "اللهم زدنا علماً",
    keyVerse: {
      text: "وَاعْبُدْ رَبَّكَ حَتَّىٰ يَأْتِيَكَ الْيَقِينُ",
      reference: "سورة الحجر: 99"
    },
    tafsir: "أمر بالاستمرار في العبادة والطاعة طوال العمر حتى يأتي الموت (اليقين)، فلا انقطاع للعمل الصالح إلا بالموت."
  },
  { 
    juz: 15, 
    surahs: "الإسراء - الكهف (74)", 
    dua: "اللهم طهر قلوبنا من النفاق",
    keyVerse: {
      text: "وَقَضَىٰ رَبُّكَ أَلَّا تَعْبُدُوا إِلَّا إِيَّاهُ وَبِالْوَالِدَيْنِ إِحْسَانًا",
      reference: "سورة الإسراء: 23"
    },
    tafsir: "قرن الله عبادته وتوحيده بالإحسان للوالدين، لعظم حقهما، ونهى عن أدنى درجات العقوق (كلمة أف)."
  },
  { 
    juz: 16, 
    surahs: "الكهف (75) - طه (135)", 
    dua: "اللهم حصن فروجنا من الزنا",
    keyVerse: {
      text: "قَالَ لَا تَخَافَا ۖ إِنَّنِي مَعَكُمَا أَسْمَعُ وَأَرَىٰ",
      reference: "سورة طه: 46"
    },
    tafsir: "طمأنة من الله لموسى وهارون بمعيته وحفظه، وهو درس لكل داعية ومؤمن بأن الله معه يسمع ويرى."
  },
  { 
    juz: 17, 
    surahs: "الأنبياء - الحج (78)", 
    dua: "اللهم اجعل أعمالنا خالصة لوجهك الكريم",
    keyVerse: {
      text: "وَمَا أَرْسَلْنَاكَ إِلَّا رَحْمَةً لِّلْعَالَمِينَ",
      reference: "سورة الأنبياء: 107"
    },
    tafsir: "بيان لغاية رسالة النبي ﷺ، فهي رحمة شاملة للإنس والجن، بل وحتى للحيوان والجماد، رحمة في الدنيا والآخرة."
  },
  { 
    juz: 18, 
    surahs: "المؤمنون - الفرقان (20)", 
    dua: "اللهم تقبل منا صيامنا وقيامنا",
    keyVerse: {
      text: "قَدْ أَفْلَحَ الْمُؤْمِنُونَ * الَّذِينَ هُمْ فِي صَلَاتِهِمْ خَاشِعُونَ",
      reference: "سورة المؤمنون: 1-2"
    },
    tafsir: "بداية سورة المؤمنون تذكر صفات الفلاح، وأولها الخشوع في الصلاة، فهو روح الصلاة ولبها."
  },
  { 
    juz: 19, 
    surahs: "الفرقان (21) - النمل (55)", 
    dua: "اللهم اعتق رقابنا من النار",
    keyVerse: {
      text: "وَعِبَادُ الرَّحْمَنِ الَّذِينَ يَمْشُونَ عَلَى الْأَرْضِ هَوْنًا وَإِذَا خَاطَبَهُمُ الْجَاهِلُونَ قَالُوا سَلَامًا",
      reference: "سورة الفرقان: 63"
    },
    tafsir: "وصف لعباد الرحمن بالتواضع والسكينة، والإعراض عن الجاهلين، ومقابلة الإساءة بالإحسان."
  },
  { 
    juz: 20, 
    surahs: "النمل (56) - العنكبوت (45)", 
    dua: "اللهم اغفر للمؤمنين والمؤمنات",
    keyVerse: {
      text: "أَمَّن يُجِيبُ الْمُضْطَرَّ إِذَا دَعَاهُ وَيَكْشِفُ السُّوءَ",
      reference: "سورة النمل: 62"
    },
    tafsir: "تذكير بأن الله وحده هو الذي يجيب دعوة المضطر ويكشف الكرب، فلا ملجأ إلا إليه."
  },
  { 
    juz: 21, 
    surahs: "العنكبوت (46) - الأحزاب (30)", 
    dua: "اللهم أصلح أحوال المسلمين",
    keyVerse: {
      text: "لَّقَدْ كَانَ لَكُمْ فِي رَسُولِ اللَّهِ أُسْوَةٌ حَسَنَةٌ لِّمَن كَانَ يَرْجُو اللَّهَ وَالْيَوْمَ الْآخِرَ",
      reference: "سورة الأحزاب: 21"
    },
    tafsir: "توجيه للمؤمنين بالاقتداء بالنبي ﷺ في جميع أحواله، في صبره وجهاده وعبادته وأخلاقه."
  },
  { 
    juz: 22, 
    surahs: "الأحزاب (31) - يس (27)", 
    dua: "اللهم انصر الإسلام والمسلمين",
    keyVerse: {
      text: "إِنَّمَا يُرِيدُ اللَّهُ لِيُذْهِبَ عَنكُمُ الرِّجْسَ أَهْلَ الْبَيْتِ وَيُطَهِّرَكُمْ تَطْهِيرًا",
      reference: "سورة الأحزاب: 33"
    },
    tafsir: "بيان لفضل أهل بيت النبي ﷺ، وإرادة الله تطهيرهم من الذنوب والنقائص، وتكريمهم."
  },
  { 
    juz: 23, 
    surahs: "يس (28) - الزمر (31)", 
    dua: "اللهم ارحم موتانا وموتى المسلمين",
    keyVerse: {
      text: "قُلْ يَا عِبَادِيَ الَّذِينَ أَسْرَفُوا عَلَىٰ أَنفُسِهِمْ لَا تَقْنَطُوا مِن رَّحْمَةِ اللَّهِ ۚ إِنَّ اللَّهَ يَغْفِرُ الذُّنُوبَ جَمِيعًا",
      reference: "سورة الزمر: 53"
    },
    tafsir: "أرجى آية في كتاب الله، تفتح باب الأمل لكل عاصٍ، وتخبر بسعة مغفرة الله لجميع الذنوب لمن تاب."
  },
  { 
    juz: 24, 
    surahs: "الزمر (32) - فصلت (46)", 
    dua: "اللهم اشف مرضانا ومرضى المسلمين",
    keyVerse: {
      text: "ادْعُونِي أَسْتَجِبْ لَكُمْ",
      reference: "سورة غافر: 60"
    },
    tafsir: "وعد صادق من الله باستجابة الدعاء لمن دعاه، وأمر بالدعاء الذي هو العبادة."
  },
  { 
    juz: 25, 
    surahs: "فصلت (47) - الجاثية (37)", 
    dua: "اللهم اختم بالباقيات الصالحات أعمالنا",
    keyVerse: {
      text: "وَمَنْ أَحْسَنُ قَوْلًا مِّمَّن دَعَا إِلَى اللَّهِ وَعَمِلَ صَالِحًا وَقَالَ إِنَّنِي مِنَ الْمُسْلِمِينَ",
      reference: "سورة فصلت: 33"
    },
    tafsir: "ثناء على الدعاة إلى الله الذين يجمعون بين القول والعمل، ويعتزون بإسلامهم."
  },
  { 
    juz: 26, 
    surahs: "الأحقاف - الذاريات (30)", 
    dua: "اللهم توفنا مسلمين وألحقنا بالصالحين",
    keyVerse: {
      text: "فَفِرُّوا إِلَى اللَّهِ ۖ إِنِّي لَكُم مِّنْهُ نَذِيرٌ مُّبِينٌ",
      reference: "سورة الذاريات: 50"
    },
    tafsir: "دعوة للفرار من عقاب الله ومعصيته إلى رحمته وطاعته، واللجوء إليه في كل حال."
  },
  { 
    juz: 27, 
    surahs: "الذاريات (31) - الحديد (29)", 
    dua: "اللهم اجعل خير أعمالنا خواتيمها",
    keyVerse: {
      text: "أَلَمْ يَأْنِ لِلَّذِينَ آمَنُوا أَن تَخْشَعَ قُلُوبُهُمْ لِذِكْرِ اللَّهِ وَمَا نَزَلَ مِنَ الْحَقِّ",
      reference: "سورة الحديد: 16"
    },
    tafsir: "عتاب رقيق من الله للمؤمنين، وحث لهم على الخشوع عند ذكر الله وتلاوة القرآن."
  },
  { 
    juz: 28, 
    surahs: "المجادلة - التحريم (12)", 
    dua: "اللهم اجعل خير أيامنا يوم نلقاك",
    keyVerse: {
      text: "وَمَن يَتَّقِ اللَّهَ يَجْعَل لَّهُ مَخْرَجًا * وَيَرْزُقْهُ مِنْ حَيْثُ لَا يَحْتَسِبُ",
      reference: "سورة الطلاق: 2-3"
    },
    tafsir: "بشارة للمتقين بأن الله يكفيهم همومهم، ويجعل لهم من كل ضيق مخرجاً، ويرزقهم من طرق لا يتوقعونها."
  },
  { 
    juz: 29, 
    surahs: "الملك - المرسلات (50)", 
    dua: "اللهم اجعلنا من عتقاء شهر رمضان",
    keyVerse: {
      text: "تَبَارَكَ الَّذِي بِيَدِهِ الْمُلْكُ وَهُوَ عَلَىٰ كُلِّ شَيْءٍ قَدِيرٌ",
      reference: "سورة الملك: 1"
    },
    tafsir: "تعظيم لله تعالى الذي بيده التصرف المطلق في الكون، وهي سورة تشفع لصاحبها وتنجيه من عذاب القبر."
  },
  { 
    juz: 30, 
    surahs: "النبأ - الناس", 
    dua: "اللهم تقبل منا إنك أنت السميع العليم",
    keyVerse: {
      text: "إِنَّا أَنزَلْنَاهُ فِي لَيْلَةِ الْقَدْرِ",
      reference: "سورة القدر: 1"
    },
    tafsir: "تنويه بفضل ليلة القدر التي أنزل فيها القرآن، وأنها خير من ألف شهر، وفيها تتنزل الملائكة بالرحمة."
  },
];

